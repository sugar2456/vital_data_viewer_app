# Research: 直近一週間のデータ参照機能

**Date**: 2026-01-22
**Feature**: 002-weekly-data

## Fitbit API 週間データ取得

### Decision
各データ種別ごとに日別にAPIを7回呼び出して取得する。

### Rationale
- Fitbit APIには期間指定の一括取得エンドポイントが一部のデータ種別でしか提供されていない
- 歩数は `fetchStepPeriod` が既存だが、他のデータ種別は日別取得のみ
- 一貫性のため、全データ種別で日別取得を7回行う方式を採用
- パフォーマンス要件（5秒以内）は並列実行で達成可能

### Alternatives Considered
1. **期間指定API利用** - 全データ種別で対応していないため却下
2. **キャッシュ導入** - スコープ外、既存アーキテクチャに追加の複雑性を導入するため却下

---

## 棒グラフ表示

### Decision
fl_chart の BarChart を使用して週間データを表示する。

### Rationale
- fl_chart は既にプロジェクトで使用されている（pubspec.yaml に依存関係あり）
- BarChart は日別データの比較表示に適している
- カスタマイズ性が高く、既存のUIに統合しやすい

### Alternatives Considered
1. **graphic パッケージ** - 既存だが、fl_chart の方がドキュメントが充実
2. **カスタム描画** - 実装コストが高いため却下

---

## データなし表示

### Decision
データがない日は棒グラフで高さ0の棒を表示し、ラベルに「-」を表示する。

### Rationale
- 視覚的に一貫性を保てる
- ユーザーがデータなしを明確に認識できる
- 既存のエラーハンドリングパターンと整合

### Alternatives Considered
1. **棒を非表示** - 日付の連続性が崩れるため却下
2. **グレー表示** - 実装は可能だが、シンプルさを優先

---

## 睡眠ステージの棒グラフ

### Decision
積み上げ棒グラフ（Stacked Bar Chart）を使用して、各睡眠ステージを色分け表示する。

### Rationale
- 総睡眠時間と各ステージの内訳を同時に可視化できる
- fl_chart の StackedBarChart で実装可能
- 仕様要件（4種類の睡眠ステージ表示）を満たす

### Alternatives Considered
1. **個別棒グラフ** - 比較が困難になるため却下
2. **円グラフ** - 日別比較に不向きなため却下
