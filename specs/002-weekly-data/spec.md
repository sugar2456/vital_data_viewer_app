# Feature Specification: 直近一週間のデータ参照機能

**Feature Branch**: `002-weekly-data`
**Created**: 2026-01-22
**Status**: Draft
**Input**: User description: "直近一週間のデータを参照できるようにする（歩数、消費カロリー、心拍数、水泳ストローク、睡眠時間）"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 週間歩数データの確認 (Priority: P1)

ユーザーとして、直近一週間の歩数データを確認したい。日々の歩数の推移を把握し、運動習慣の傾向を理解するため。

**Why this priority**: 歩数は最も基本的かつ頻繁に確認されるバイタルデータであり、ユーザーの日常的な活動量を把握する上で最重要。

**Independent Test**: 歩数画面で過去7日間のデータが棒グラフ形式で表示され、各日の歩数が確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがログイン済みの状態, **When** 歩数画面で週間表示を選択, **Then** 直近7日間の歩数データが日別に表示される
2. **Given** 週間歩数データが表示されている状態, **When** 特定の日をタップ, **Then** その日の詳細な歩数情報が表示される
3. **Given** 一部の日にデータがない状態, **When** 週間表示を選択, **Then** データがある日のみ表示され、データなしの日は「データなし」と表示される

---

### User Story 2 - 週間睡眠データの確認 (Priority: P1)

ユーザーとして、直近一週間の睡眠データ（総睡眠時間と各睡眠ステージの内訳）を確認したい。睡眠の質と量の傾向を把握するため。

**Why this priority**: 睡眠データは健康管理において歩数と並ぶ重要指標であり、睡眠ステージの内訳という独自の要件がある。

**Independent Test**: 睡眠画面で過去7日間の睡眠データが表示され、各日の総睡眠時間と睡眠ステージ（深い睡眠、浅い睡眠、レム睡眠、覚醒）の内訳が確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがログイン済みの状態, **When** 睡眠画面で週間表示を選択, **Then** 直近7日間の睡眠データが日別に表示される
2. **Given** 週間睡眠データが表示されている状態, **When** 各日のデータを確認, **Then** 総睡眠時間と各睡眠ステージ（深い睡眠、浅い睡眠、レム睡眠、覚醒）の時間が表示される
3. **Given** 睡眠データがない日がある状態, **When** 週間表示を選択, **Then** データなしの日は「データなし」と表示される

---

### User Story 3 - 週間心拍数データの確認 (Priority: P2)

ユーザーとして、直近一週間の心拍数データを確認したい。心臓の健康状態と運動強度の傾向を把握するため。

**Why this priority**: 心拍数は健康状態の重要な指標だが、歩数・睡眠と比べると日常的な確認頻度は低い。

**Independent Test**: 心拍数画面で過去7日間のデータが表示され、各日の平均心拍数、最高心拍数、最低心拍数が確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがログイン済みの状態, **When** 心拍数画面で週間表示を選択, **Then** 直近7日間の心拍数データが日別に表示される
2. **Given** 週間心拍数データが表示されている状態, **When** 各日のデータを確認, **Then** 平均心拍数、最高心拍数、最低心拍数が表示される

---

### User Story 4 - 週間消費カロリーデータの確認 (Priority: P2)

ユーザーとして、直近一週間の消費カロリーデータを確認したい。エネルギー消費の傾向を把握し、ダイエットや健康管理に活用するため。

**Why this priority**: 消費カロリーは歩数と関連するデータであり、健康管理の補助的な指標として有用。

**Independent Test**: カロリー画面で過去7日間のデータが表示され、各日の消費カロリーが確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがログイン済みの状態, **When** カロリー画面で週間表示を選択, **Then** 直近7日間の消費カロリーデータが日別に表示される
2. **Given** 週間カロリーデータが表示されている状態, **When** 各日のデータを確認, **Then** その日の総消費カロリーが表示される

---

### User Story 5 - 週間水泳ストロークデータの確認 (Priority: P3)

ユーザーとして、直近一週間の水泳ストロークデータを確認したい。水泳トレーニングの傾向を把握するため。

**Why this priority**: 水泳データは特定のユーザー層のみが利用するため、優先度は低い。ただし、要件として明示されているため実装は必要。

**Independent Test**: 水泳画面で過去7日間のデータが表示され、各日の水泳ストローク数が確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがログイン済みの状態, **When** 水泳画面で週間表示を選択, **Then** 直近7日間の水泳ストロークデータが日別に表示される
2. **Given** 水泳をしていない日がある状態, **When** 週間表示を選択, **Then** 水泳データがない日は「データなし」または「0」と表示される

---

### Edge Cases

- データが7日分未満の場合、利用可能なデータのみ表示し、不足分は「データなし」と表示する
- ネットワークエラーが発生した場合、エラーメッセージを表示し再試行オプションを提供する
- Fitbitとの同期が遅延している場合、最新のデータが反映されるまでローディング表示する
- 日付をまたぐ睡眠データは、起床日の記録として扱う

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは直近7日間の歩数データを日別に取得・表示できなければならない
- **FR-002**: システムは直近7日間の睡眠データ（総睡眠時間、各睡眠ステージの時間）を日別に取得・表示できなければならない
- **FR-003**: システムは直近7日間の心拍数データ（平均、最高、最低）を日別に取得・表示できなければならない
- **FR-004**: システムは直近7日間の消費カロリーデータを日別に取得・表示できなければならない
- **FR-005**: システムは直近7日間の水泳ストロークデータを日別に取得・表示できなければならない
- **FR-006**: ユーザーは各画面で「日別表示」と「週間表示」を切り替えられなければならない
- **FR-007**: システムはデータがない日について「データなし」と明示的に表示しなければならない
- **FR-008**: システムはデータ取得中にローディング状態を表示しなければならない
- **FR-009**: システムはデータ取得エラー時にエラーメッセージと再試行オプションを表示しなければならない
- **FR-010**: システムは週間データを棒グラフ形式で表示しなければならない

### Key Entities

- **週間データ**: 日付、データ種別（歩数/睡眠/心拍数/カロリー/水泳）、値、単位を持つ
- **睡眠ステージ**: 睡眠種別（深い睡眠、浅い睡眠、レム睡眠、覚醒）、時間（分）を持つ
- **心拍数サマリー**: 日付、平均心拍数、最高心拍数、最低心拍数を持つ

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは3タップ以内で任意のデータ種別の週間表示に切り替えられる
- **SC-002**: 週間データの読み込みは5秒以内に完了する
- **SC-003**: 5種類すべてのデータ（歩数、睡眠、心拍数、カロリー、水泳）で週間表示が利用可能である
- **SC-004**: 睡眠データでは4種類の睡眠ステージ（深い睡眠、浅い睡眠、レム睡眠、覚醒）が表示される
- **SC-005**: データがない日は明確に識別でき、ユーザーが混乱しない

## Clarifications

### Session 2026-01-22

- Q: 週間データの表示形式は？ → A: 棒グラフ（日別の値を比較しやすい形式）

## Assumptions

- ユーザーは既にFitbitアカウントと連携済みである
- Fitbit APIが過去7日分のデータを提供可能である
- 既存の日別データ表示機能が各画面に実装済みである
- 睡眠ステージはFitbit APIが提供する4種類（deep、light、rem、wake）を使用する
